(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-581a2c02"],{"008f":function(e,i,t){"use strict";var a=t("72ea"),s=t.n(a);i["default"]=s.a},2008:function(e,i,t){e.exports={windows:"index_windows_FcOWq",alert:"index_alert_h1205",placeholder:"index_placeholder_19veO",upload:"index_upload_31RhV","placeholder-opacity":"index_placeholder-opacity_20r8y","button-select":"index_button-select_2VNnM"}},"4d39":function(e,i,t){"use strict";t.r(i);var a=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"main-wrapper"},[t("el-card",{attrs:{shadow:"never"}},[t("el-tabs",{model:{value:e.activeName,callback:function(i){e.activeName=i},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"对话框调用",name:"tab1"}},[t("x-dialog")],1),t("el-tab-pane",{attrs:{label:"直接调用",name:"tab2"}},[t("x-inset")],1)],1)],1)],1)},s=[],n=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleOpen}},[e._v("人像上传")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleOpen2}},[e._v("人像上传")]),t("camera-upload",{attrs:{visible:e.cameraUploadVisible,onSubmit:e.handleSubmit,upload:!0,"http-request":e.api.upload},on:{"update:visible":function(i){e.cameraUploadVisible=i}}}),t("camera-upload2",{attrs:{visible:e.cameraUploadVisible2,action:"http://127.0.0.1:8001/service/file/upload",onSubmit:e.handleSubmit},on:{"update:visible":function(i){e.cameraUploadVisible2=i}}})],1)},o=[],l=t("fe27"),r=Object(l["a"])({url:"http://127.0.0.1:8001/service/file/upload"}),c=function(e){var i=new FormData;i.append("avatar",e);var t={headers:{"Content-Type":"multipart/form-data"}};return r.post("",i,t).then(function(e){return e.data})},d={upload:c},h=function(){var e,i=this,t=i.$createElement,a=i._self._c||t;return a("div",[a("el-dialog",{staticClass:"or-dialog-wrapper",attrs:{title:i.title,visible:i.visible,"before-close":i.handleClose,"close-on-click-modal":!1,"custom-class":"or-dialog",width:i.dialogWidth,top:"0"},on:{"update:visible":function(e){i.visible=e}}},[a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:i.loading,expression:"loading"}],class:i.$style.windows,style:i.windowStyle},[a("el-image",{directives:[{name:"show",rawName:"v-show",value:i.imageVisible,expression:"imageVisible"}],attrs:{src:i.fixedImageUrl,fit:"cover"}}),a("video",{directives:[{name:"show",rawName:"v-show",value:i.videoVisible,expression:"videoVisible"}],attrs:{width:i.width,height:i.height}}),a("canvas",{directives:[{name:"show",rawName:"v-show",value:i.canvasVisible,expression:"canvasVisible"}],attrs:{width:i.width,height:i.height}}),a("div",{directives:[{name:"show",rawName:"v-show",value:i.alertVisible,expression:"alertVisible"}],class:i.$style.alert},[a("transition",{attrs:{name:"el-fade-in-linear"}},[a("el-alert",{directives:[{name:"show",rawName:"v-show",value:i.alertSuccessVisible,expression:"alertSuccessVisible"}],attrs:{title:"提示",type:"success",center:"","show-icon":"",closable:!1,description:i.description}})],1),a("transition",{attrs:{name:"el-fade-in-linear"}},[a("el-alert",{directives:[{name:"show",rawName:"v-show",value:i.alertErrorVisible,expression:"alertErrorVisible"}],attrs:{title:"提示",type:"error",center:"","show-icon":"",closable:!1,description:i.description}})],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:i.placeholderVisible,expression:"placeholderVisible"}],class:[(e={},e[i.$style["placeholder-opacity"]]=i.placeholderOpacity,e),i.$style.placeholder]},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:i.loading,expression:"loading"},{name:"show",rawName:"v-show",value:i.cameraVisible,expression:"cameraVisible"}],staticClass:"flex-center",attrs:{disabled:i.loading},on:{click:i.handleOpenCamera}},[a("i",{staticClass:"fas fa-camera fa-5x"})]),a("div",{directives:[{name:"show",rawName:"v-show",value:i.uploadVisible,expression:"uploadVisible"}],staticClass:"flex-center"},[a("el-upload",{ref:"upload",staticClass:"fullsize",class:i.$style.upload,attrs:{action:"",accept:".jpg,.png,.jpeg","on-change":i.handleUploadChange,"on-success":i.handleUploadSuccess,"on-error":i.handleUploadError,"file-list":i.fileList,"show-file-list":!1,"auto-upload":!1,"http-request":i.customUpload}},[a("div",{staticClass:"flex-center abs-fullsize",attrs:{slot:"trigger"},slot:"trigger"},[a("i",{staticClass:"fas fa-upload fa-5x"})])])],1)])],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:i.cancelVisible,expression:"cancelVisible"}],attrs:{loading:i.loading,disabled:i.loading},on:{click:i.handleClose}},[i._v("取消")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:i.saveVisible,expression:"saveVisible"}],attrs:{loading:i.loading,disabled:i.loading,type:"primary"},on:{click:i.handleSave}},[i._v(i._s(i.submitText))]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:i.backVisible,expression:"backVisible"}],attrs:{loading:i.loading,disabled:i.loading},on:{click:i.handleBack}},[i._v("返回")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:i.videoVisible,expression:"videoVisible"}],attrs:{loading:i.loading,disabled:i.loading,type:"primary"},on:{click:i.handleShot}},[i._v("拍摄")])],1)],1)],1)},u=[];t("6762"),t("2fdb"),t("c5f6");function p(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}var v=t("85f2"),w=t.n(v);function b(e,i){for(var t=0;t<i.length;t++){var a=i[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),w()(e,a.key,a)}}function m(e,i,t){return i&&b(e.prototype,i),t&&b(e,t),e}t("7f7f");function f(e,i){var t=e.video;t&&(t.srcObject=i,t.play(),e.successCallback&&e.successCallback(t))}function g(e,i){throw e.successCallback&&e.successCallback(i),new Error("访问用户媒体设备失败".concat(i.name,", ").concat(i.message))}var y=function(){function e(i,t){p(this,e);var a=Object.assign({width:480,height:320,successCallback:function(){},errorCallback:function(){}},t);this.video=i,this.constraints={video:{width:a.width,height:a.height}},this.canvas=a.canvas,this.successCallback=a.successCallback,this.errorCallback=a.errorCallback}return m(e,[{key:"getUserMedia",value:function(e,i){var t=this.constraints;navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(t).then(e).catch(i):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(t,e,i):navigator.mozGetUserMedia?navigator.mozGetUserMedia(t,e,i):navigator.getUserMedia&&navigator.getUserMedia(t,e,i)}},{key:"start",value:function(){var e=this;if(!this.constructor.isSupport())throw new Error("不支持访问用户媒体");this.getUserMedia(function(i){f(e,i)},function(i){g(e,i)})}},{key:"stop",value:function(){var e=this.video;e.pause(),e.srcObject&&(e.srcObject.getVideoTracks()[0].stop(),e.srcObject=null)}},{key:"shot",value:function(){var e=this.canvas,i=this.video,t=this.constraints,a=t.video,s=a.width,n=a.height,o=e.getContext("2d");o.drawImage(i,0,0,s,n)}}],[{key:"isSupport",value:function(){return!!(navigator.mediaDevices.getUserMedia||navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia)}}]),e}(),V=y,S="upload",x="camera",U="image",W="vidoe",C="canvas",k="placeholder",_="照片拍摄成功",N="打开摄像头失败",E={props:{name:{type:String,default:"avatar"},visible:{type:Boolean,default:!1},title:{type:String,default:"拍照上传"},type:{type:Array,default:function(){return[S,x]}},width:{type:Number,default:480},height:{type:Number,default:320},upload:{type:Boolean,default:!0},onSuccess:{type:Function},onError:{type:Function},onSubmit:{type:Function},submitText:{type:String,default:"保存"},src:{type:String},httpRequest:{type:Function},beforeUpload:{type:Function,default:function(){return!0}}},data:function(){return{loading:!1,currentWindow:"",lastWindow:k,imageUrl:"",fileList:[],camera:null,isShoted:!1,alertVisible:!1,alertSuccessVisible:!1,alertErrorVisible:!1,canvas:null,description:""}},computed:{dialogWidth:function(){var e=40,i=2;return"".concat(this.width+e+i,"px")},windowStyle:function(){return{width:"".concat(this.width,"px"),height:"".concat(this.height,"px")}},cameraVisible:function(){return this.type.includes(x)},uploadVisible:function(){return this.type.includes(S)},imageVisible:function(){return this.currentWindow===U},videoVisible:function(){return this.currentWindow===W},canvasVisible:function(){return this.currentWindow===C},placeholderOpacity:function(){return this.currentWindow===k},placeholderVisible:function(){return this.currentWindow===k||this.imageVisible||this.canvasVisible},backVisible:function(){return this.videoVisible},saveVisible:function(){var e=this.isImageSelected||this.isShoted,i=[C,U].includes(this.currentWindow);return e&&i},cancelVisible:function(){return!this.videoVisible},fixedImageUrl:function(){return this.imageUrl||this.src||""},isImageSelected:function(){return""!==this.imageUrl},uploadDisabled:function(){return this.loading||this.currentWindow===W}},watch:{visible:function(e){e&&this.initWindow()}},methods:{initWindow:function(){this.currentWindow="",this.isShoted=!1,this.imageUrl="",this.fileList=[],this.lastWindow=k,this.toggleWindow(k),this.src&&(this.lastWindow=U,this.toggleWindow(U))},handleClose:function(){this.loading||(this.closeCamera(),this.$emit("update:visible",!1))},handleSave:function(){var e=this;this.isImageSelected&&this.lastWindow===U&&(this.upload&&this.uploadImage(),!this.upload&&this.onSubmit(this.imageUrl)),this.isShoted&&this.lastWindow===C&&(this.upload&&this.canvas.toBlob(function(i){return e.uploadShot(i)}),!this.upload&&this.canvas.toBlob(function(i){return e.onSubmit(i)}))},handleOpenCamera:function(){var e=this;if(!this.videoVisible){if(this.loading=!0,this.toggleWindow(W),!this.camera){var i=document.querySelector(".".concat(this.$style.windows)),t=i.querySelector("video"),a=i.querySelector("canvas");this.canvas=a;var s={canvas:a,width:this.width,height:this.height,successCallback:function(){e.loading=!1}};this.camera=new V(t,s)}try{this.camera.start()}catch(n){this.description=N,this.showAlert("Error")}}},closeCamera:function(){this.camera&&this.camera.stop()},handleShot:function(){this.camera.shot(),this.closeCamera(),this.isShoted=!0,this.toggleWindow(C),this.lastWindow=C,this.description=_,this.showAlert("Success")},handleBack:function(){this.closeCamera(),this.showLastWindow(),this.currentWindow===W&&this.closeCamera()},submitUpload:function(){this.$refs.upload.submit()},showLastWindow:function(){this.toggleWindow(this.lastWindow)},toggleWindow:function(e){this.currentWindow=e},handleUploadChange:function(e,i){this.toggleWindow(U),this.lastWindow=U,e.response||this.preview(e,i)},preview:function(e,i){var t=this;i.length>1&&i.splice(0,1);var a=window,s=a.event,n=s.target.files[0],o=new FileReader;o.onload=function(e){t.imageUrl=e.target.result},o.readAsDataURL(n)},showAlert:function(e){var i=this;this.alertVisible=!0,this["alert".concat(e,"Visible")]=!0,setTimeout(function(){i["alert".concat(e,"Visible")]=!1},1500)},uploadImage:function(){this.$refs.upload.submit()},uploadShot:function(e){this.myUpload(e)},customUpload:function(e){this.myUpload(e.file)},myUpload:function(e){var i=this,t=this.beforeUpload(e);!0===t&&(this.loading=!0,this.httpRequest(e).then(function(t){return i.handleUploadSuccess(t,e)}).catch(function(t){return i.handleUploadError(t,e)}))},handleUploadSuccess:function(e,i){this.loading=!1,this.onSuccess&&this.onSuccess(e,i),this.handleClose()},handleUploadError:function(e,i){this.loading=!1,this.onError&&this.onError(e,i)}}},O=E,$=t("7dba"),j=t("2877");function I(e){this["$style"]=$["default"].locals||$["default"]}var M=Object(j["a"])(O,h,u,!1,I,null,null),F=M.exports,B=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",[t("el-dialog",{staticClass:"or-dialog-wrapper",attrs:{title:e.title,visible:e.visible,"before-close":e.handleClose,"close-on-click-modal":!1,"custom-class":"or-dialog",width:e.dialogWidth,top:"0"},on:{"update:visible":function(i){e.visible=i}}},[t("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],class:e.$style.windows,style:e.windowStyle},[t("el-image",{directives:[{name:"show",rawName:"v-show",value:e.imageVisible,expression:"imageVisible"}],attrs:{src:e.fixedImageUrl,fit:"cover"}}),t("video",{directives:[{name:"show",rawName:"v-show",value:e.videoVisible,expression:"videoVisible"}],attrs:{width:e.width,height:e.height}}),t("canvas",{directives:[{name:"show",rawName:"v-show",value:e.canvasVisible,expression:"canvasVisible"}],attrs:{width:e.width,height:e.height}}),t("div",{directives:[{name:"show",rawName:"v-show",value:e.placeholderVisible,expression:"placeholderVisible"}],class:e.$style.placeholder},[t("el-alert",{attrs:{title:"提示",type:"info",center:"","show-icon":"",closable:!1,description:"请选择拍照或者上传图片"}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.alertVisible,expression:"alertVisible"}],class:e.$style.alert},[t("transition",{attrs:{name:"el-fade-in-linear"}},[t("el-alert",{directives:[{name:"show",rawName:"v-show",value:e.alertSuccessVisible,expression:"alertSuccessVisible"}],attrs:{title:"提示",type:"success",center:"","show-icon":"",closable:!1,description:"照片拍摄成功"}})],1),t("transition",{attrs:{name:"el-fade-in-linear"}},[t("el-alert",{directives:[{name:"show",rawName:"v-show",value:e.alertErrorVisible,expression:"alertErrorVisible"}],attrs:{title:"提示",type:"error",center:"","show-icon":"",closable:!1,description:"打开摄像头失败"}})],1)],1)],1),t("div",{class:e.$style["button-select"]},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.cameraVisible,expression:"cameraVisible"}],attrs:{loading:e.loading,disabled:e.loading,type:"primary"},on:{click:e.handleOpenCamera}},[e._v("拍照")]),t("el-upload",{ref:"upload",class:e.$style.upload,attrs:{name:e.name,accept:".jpg,.png,.jpeg",action:e.action,headers:e.headers,"on-change":e.handleUploadChange,"on-success":e.handleUploadSuccess,"on-error":e.handleUploadError,"file-list":e.fileList,"show-file-list":!1,"auto-upload":!1}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.uploadVisible,expression:"uploadVisible"}],attrs:{slot:"trigger",loading:e.loading,disabled:e.uploadDisabled,type:"primary"},slot:"trigger"},[e._v("上传图片")])],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.cancelVisible,expression:"cancelVisible"}],attrs:{loading:e.loading,disabled:e.loading},on:{click:e.handleClose}},[e._v("取消")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.saveVisible,expression:"saveVisible"}],attrs:{loading:e.loading,disabled:e.loading,type:"primary"},on:{click:e.handleSave}},[e._v(e._s(e.submitText))]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.backVisible,expression:"backVisible"}],attrs:{loading:e.loading,disabled:e.loading},on:{click:e.handleBack}},[e._v("返回")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.videoVisible,expression:"videoVisible"}],attrs:{loading:e.loading,disabled:e.loading,type:"primary"},on:{click:e.handleShot}},[e._v("拍摄")])],1)],1)],1)},L=[],q=t("2c38"),D="upload",A="camera",T="image",G="vidoe",R="canvas",z="placeholder",J={props:{name:{type:String,default:"avatar"},action:{type:String},headers:{type:Object},visible:{type:Boolean,default:!1},title:{type:String,default:"拍照上传"},type:{type:Array,default:function(){return[D,A]}},width:{type:Number,default:480},height:{type:Number,default:320},upload:{type:Boolean,default:!0},onSuccess:{type:Function},onError:{type:Function},onSubmit:{type:Function},submitText:{type:String,default:"保存"},src:{type:String}},data:function(){return{loading:!1,currentWindow:"",lastWindow:z,imageUrl:"",fileList:[],camera:null,isShoted:!1,alertVisible:!1,alertSuccessVisible:!1,alertErrorVisible:!1,canvas:null}},computed:{dialogWidth:function(){var e=40,i=2;return"".concat(this.width+e+i,"px")},windowStyle:function(){return{width:"".concat(this.width,"px"),height:"".concat(this.height,"px")}},cameraVisible:function(){return this.type.includes(A)},uploadVisible:function(){return this.type.includes(D)},imageVisible:function(){return this.currentWindow===T},videoVisible:function(){return this.currentWindow===G},canvasVisible:function(){return this.currentWindow===R},placeholderVisible:function(){return this.currentWindow===z},backVisible:function(){return this.videoVisible},saveVisible:function(){var e=this.isImageSelected||this.isShoted,i=[R,T].includes(this.currentWindow);return e&&i},cancelVisible:function(){return!this.videoVisible},fixedImageUrl:function(){return this.imageUrl||this.src},isImageSelected:function(){return""!==this.imageUrl},uploadDisabled:function(){return this.loading||this.currentWindow===G}},watch:{visible:function(e){e&&this.initWindow()}},methods:{initWindow:function(){this.currentWindow="",this.isShoted=!1,this.imageUrl="",this.fileList=[],this.lastWindow=z,this.toggleWindow(z),this.src&&(this.lastWindow=T,this.toggleWindow(T))},handleClose:function(){this.loading||(this.closeCamera(),this.$emit("update:visible",!1))},handleSave:function(){var e=this;this.isImageSelected&&this.lastWindow===T&&(this.upload&&this.uploadImage(),!this.upload&&this.onSubmit(this.imageUrl)),this.isShoted&&this.lastWindow===R&&(this.upload&&this.canvas.toBlob(function(i){return e.uploadShot(i)}),!this.upload&&this.canvas.toBlob(function(i){return e.onSubmit(i)}))},handleOpenCamera:function(){var e=this;if(!this.videoVisible){if(this.loading=!0,this.toggleWindow(G),!this.camera){var i=document.querySelector(".".concat(this.$style.windows)),t=i.querySelector("video"),a=i.querySelector("canvas");this.canvas=a;var s={canvas:a,width:this.width,height:this.height,successCallback:function(){e.loading=!1}};this.camera=new V(t,s)}try{this.camera.start()}catch(n){this.showAlert("Error")}}},closeCamera:function(){this.camera&&this.camera.stop()},handleShot:function(){this.camera.shot(),this.closeCamera(),this.isShoted=!0,this.toggleWindow(R),this.lastWindow=R,this.showAlert("Success")},handleBack:function(){this.closeCamera(),this.showLastWindow(),this.currentWindow===G&&this.closeCamera()},submitUpload:function(){this.$refs.upload.submit()},showLastWindow:function(){this.toggleWindow(this.lastWindow)},toggleWindow:function(e){this.currentWindow=e},handleUploadChange:function(e,i){this.toggleWindow(T),this.lastWindow=T,e.response||this.preview(e,i)},preview:function(e,i){var t=this;i.length>1&&i.splice(0,1);var a=window,s=a.event,n=s.target.files[0],o=new FileReader;o.onload=function(e){t.imageUrl=e.target.result},o.readAsDataURL(n)},showAlert:function(e){var i=this;this.alertVisible=!0,this["alert".concat(e,"Visible")]=!0,setTimeout(function(){i["alert".concat(e,"Visible")]=!1},1500)},uploadImage:function(){this.loading=!1,this.$refs.upload.submit()},uploadShot:function(e){var i=this;this.loading=!0;var t=new FormData;t.append(this.name,e),Object(q["i"])({method:"post",url:this.action,data:t,headers:this.header}).then(function(t){i.handleUploadSuccess(t,e)}).catch(function(t){i.handleUploadError(t,e)})},handleUploadSuccess:function(e,i){this.loading=!1,this.onSubmit&&this.onSubmit(e,i),this.handleClose()},handleUploadError:function(e,i){this.loading=!1,this.onError&&this.onError(e,i)}}},X=J,Q=t("008f");function Z(e){this["$style"]=Q["default"].locals||Q["default"]}var H=Object(j["a"])(X,B,L,!1,Z,null,null),K=H.exports,P={components:{CameraUpload:F,CameraUpload2:K},data:function(){return{api:d,cameraUploadVisible:!1,cameraUploadVisible2:!1}},methods:{handleOpen:function(){this.cameraUploadVisible=!0},handleOpen2:function(){this.cameraUploadVisible2=!0},handleSubmit:function(e){}}},Y=P,ee=Object(j["a"])(Y,n,o,!1,null,null,null),ie=ee.exports,te={components:{XDialog:ie,XInset:function(){return t.e("chunk-2d0b3402").then(t.bind(null,"2828"))}},data:function(){return{activeName:"tab1"}}},ae=te,se=Object(j["a"])(ae,a,s,!1,null,null,null);i["default"]=se.exports},"72ea":function(e,i,t){e.exports={windows:"index2_windows_2yN8p",alert:"index2_alert_1JVr-",placeholder:"index2_placeholder_3JZ1G",upload:"index2_upload_2xiQe","button-select":"index2_button-select_3iXaC"}},"7dba":function(e,i,t){"use strict";var a=t("2008"),s=t.n(a);i["default"]=s.a}}]);